@{
    ViewData["Title"] = "Página Inicial";
    int countAtas = ViewBag.AtasPublicada + ViewBag.Pendentes;
}

<div class="card shadow-lg">
    <div class="card-header text-center">
        <h5>Gráficos Quantitativos</h5>
    </div>
    <div class="card-body d-flex flex-wrap text-center">
        <div class=" col-md-6">
            <div><canvas id="ChartAtasYears"></canvas></div>
        </div>
        <div class="col-md-6">
            <div> <canvas id="ChartAtasMonths"></canvas></div>
        </div>
        <div class="d-flex flex-row flex-wrap col-md-12 mt-3">
            <div class="col-md-4">
                <div class=" mt-3 text-center">
                    <h5 class="card-title">Atas Publicadas</h5>
                </div>
                <div class="card-body">
                    <h5>@ViewBag.AtasPublicada</h5>
                </div>
            </div>
            <div class=" col-md-4">
                <div class=" mt-3 text-center">
                    <h5 class="card-title">Atas Pendêntes</h5>
                </div>
                <div class="card-body">
                    <h5>@ViewBag.Pendentes</h5>
                </div>
            </div>
            <div class="col-md-4">
                <div class=" mt-3 text-center">
                    <h5 class="card-title">Total de Atas</h5>
                </div>
                <div class="card-body">
                    <h5>@countAtas</h5>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts
    {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="/lib/chart/chart.min.js"></script>
    <script>
        $(document).ready(function () {

            //Atas por Ano
            $.ajax({
                type: 'GET',
                async: true,
                url: '/Ata/GetAtasGraphicsByYears/',
                success: function (response) {
                    const labels = [];
                    const datas = [];
                    for (var year = 0; year < response.length; year++) {
                        labels[year] = response[year].year
                        datas[year] = response[year].count
                    }
                    const data = {
                        labels: labels,
                        datasets: [{
                            label: 'Atas por Ano',
                            data: datas,
                            backgroundColor: 'rgba(19, 41, 61, 1)',
                            borderColor: 'rgba(36, 123, 160, 1)',
                            borderWidth: 1
                        }]
                    };

                    const config = {
                        type: 'bar',
                        data: data,
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        },
                    };

                    const myChartAtaAno = new Chart(
                        document.getElementById('ChartAtasYears'),
                        config
                    );
                }
            })

            //Atas por mês
            $.ajax({
                type: 'GET',
                async: true,
                url: '/Ata/GetAtasGraphicsByMonths/',
                success: function (response) {
                    const labels = [];
                    const datas = [];
                    const dataAtual = new Date();
                    const anoAtual = dataAtual.getFullYear();

                    for (var month = 0; month < response.length; month++) {
                        labels[month] = response[month].month
                        datas[month] = response[month].count
                    }
                    const data = {
                        labels: labels,
                        datasets: [{
                            label: `Atas por Mês (${anoAtual})`,
                            data: datas,
                            backgroundColor: 'rgba(19, 41, 61, 1)',
                            borderColor: 'rgba(36, 123, 160, 1)',
                            borderWidth: 1
                        }]
                    };


                    const config = {
                        type: 'line',
                        data: data,
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        },
                    };

                    const myChart = new Chart(
                        document.getElementById('ChartAtasMonths'),
                        config
                    );
                }
            })
        });      
    </script>
    }